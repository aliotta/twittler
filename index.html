<!DOCTYPE html>
<html>
  <head>
	<meta charset="utf-8">
	<title>Twittler Homepage</title>
	<link rel="stylesheet" href="main.css"> 
    <link href='http://fonts.googleapis.com/css?family=Lato:100,300,400' rel='stylesheet' type='text/css'>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/moment.js/2.10.3/moment.min.js"></script>
  </head>
  <body>
    <script>
    	moment().format();
        var allMessages =[];
        var usersTweetHistory = {};
        function loadTweetHistory(){
      	    var index = streams.home.length -1;
      	    var $tweetFeed = $('#tweetFeed');
			while(index >= 0){ 
				var tweet = streams.home[index];
				var message = tweet.message + ' ' + tweet.created_at;
				if(allMessages.indexOf(message) === -1){
					allMessages.push(message);
					if (tweet.user in usersTweetHistory){ // updates message history to include current message
						usersTweetHistory[tweet.user].push(message); 
					} else{ // initializes message history for user when they tweet their first message
						var messages = [message]; 
						usersTweetHistory[tweet.user] = messages;
			    	};
			    	var $tweet = $('<div class="tweet"></div>');
			    	var $userTag = $('<div class="user"></div>');
			    	$userTag.text('@' + tweet.user);
	            	$tweet.text(': ' + tweet.message + ' ' + moment(tweet.created_at).fromNow());
		            $tweet.appendTo($tweetFeed);
				    $userTag.prependTo($tweet);
				}
				index -=1;
			}
        }

		function logUserTagEventHandler(){
			$('.user').on('click', function(){ //loads tweet history of user when tag is clicked
			
				var $userHistory = $('#userHistory');
				$userHistory.html('');  //clear previously selected users information
				var selectedUser = $(this).text().slice(1); // remove @ symbol from user tag
				var $selectedUserTitle = $('<div>' + selectedUser +'\'s Tweet History</div>'); // create a title for history
				$selectedUserTitle.appendTo($userHistory);
				var userMessages = usersTweetHistory[selectedUser]; // get object corresponding to users messages
				for (i=0; i< userMessages.length; i++){ // for each message output in history section
					var $oldTweet = $('<div class="oldTweet"></div>');
					$oldTweet.text(userMessages[i]);
					$oldTweet.appendTo($userHistory);
				};
			});
		}

        $(document).ready(function(){
			loadTweetHistory();
			logUserTagEventHandler();

			$('.refresh').on('click', function(){ //load new tweet data on click of refresh button
				loadTweetHistory();
				logUserTagEventHandler();
			});

      });

    </script>
	<header class="primary-header group container">
		<h1>Twittler</h1>
		<nav class="nav primary-nav">
			<ul>
				<li><h4>Home</h4></li>
				<li class="refresh"><h4>Refresh</h4></li>
				<li><h4>My Feed</h4></li>
			</ul>
		</nav>
	</header>
	<section class="homerow">
		<section class="container tweetFeed" id="tweetFeed">
		</section>
		<section class="container" id="userHistory">
		</section>
	</section>
	<footer class="primary-footer group container">
	</footer>
  </body>
</html>
